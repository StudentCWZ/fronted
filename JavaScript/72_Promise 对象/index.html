<!--
 * @Software: Visual Studio Code
 * @Author: StudentCWZ
 * @Email: StudentCWZ@outlook.com
 * @Date: 2023-11-01 08:26:44
 * @Last Modified by: StudentCWZ
 * @Description: Promise 对象
-->

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Promise 对象</title>
</head>

<body>
    <div id="box">等待加载</div>
    <script>
        // 基本概念
        // promise 时异步编程的一种解决方案，比传统的解决方案--回调函数和事件--更合理和强大。它由社区最早提出和实现，ES6 将其写进了语言标准，统一了用法，原生提供了 Promise 对象
        // 所谓 Promise，简单说就是一个容器，里面保存着某个未来才会结束的事件(通常是个异步操作)的结果。从语法上来说，Promise 是一个对象，从它可以获取异步操作的消息。Promise 提供了统一的 API 各种异步操作都可以用同样的方法进行处理
        // Promise 对象提供统一的接口，使得控制异步操作更加容易
        // ES6 规定，Promise 对象是一个构造函数，用来生成 Promise 实例
        // Promise 构造函数接受一个函数作为参数，该函数的两个参数分别是 resolved 状态和 rejected 状态的回调函数
        var box = document.getElementById("box");
        function loadImageAsync(url) {
            const promise = new Promise(function (resolve, reject) {
                // 异步处理：消耗时间的代码
                const image = new Image(); // image 创建 image 对象
                image.src = url;
                image.onload = function () {
                    resolve(image);
                }
                image.onerror = function () {
                    reject(new Error('Could not load image at' + url))
                }
            });
            return promise;
        }
        const promise = loadImageAsync("https://img.shields.io/badge/-Python-black?style=flat-square&font=Monaco&logo=python");
        promise.then(function (data) {
            // 成功
            box.appendChild(data)
        }, function (error) {
            // 失败
            box.innerHTML = "图片加载失败";
            console.log(error);
        })
    </script>

</body>

</html>